
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Dungeon Crawler</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; display: flex; }
    #leftPanel { display: flex; flex-direction: column; }
    #game { white-space: pre; padding: 10px; font-size: 16px; line-height: 1.2; height: 360px; overflow-y: auto; }
    #status { white-space: pre-wrap; padding: 10px; height: 100px; overflow-y: auto; background: #222; border-top: 1px solid #0f0; }
    #command { width: 100%; background: #222; color: #0f0; border: 1px solid #0f0; padding: 4px; font-family: monospace; }
    #sidebar { width: 240px; padding: 10px; border-left: 2px solid #0f0; }
    select { width: 100%; background: #222; color: #0f0; font-family: monospace; margin-bottom: 10px; }
    #inventory, #equipment, #spells { margin-top: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div id="leftPanel">
    <select id="themeSelect">
      <option value="fantasy">ðŸ§™ Fantasy</option>
      <option value="scifi">ðŸ¤– Sci-Fi</option>
      <option value="horror">ðŸ§Ÿ Dungeon Horror</option>
    </select>
    <div id="game"></div>
    <div id="status"></div>
    <input id="command" placeholder="cast ignis east / fire west / equip sword / examine" />
  </div>
  <div id="sidebar">
    <h3>Legend</h3>
    <div id="legend"></div>
    <h4>Equipment</h4>
    <div id="equipment"></div>
    <h4>Spells</h4>
    <div id="spells"></div>
    <h4>Inventory</h4>
    <div id="inventory"></div>
  </div>
  <script>
    // GAME DATA AND UI SETUP
    const roomSize = { width: 20, height: 10 };
    const gameDisplay = document.getElementById("game");
    const commandInput = document.getElementById("command");
    const themeSelect = document.getElementById("themeSelect");
    const legendDiv = document.getElementById("legend");
    const inventoryDiv = document.getElementById("inventory");
    const equipmentDiv = document.getElementById("equipment");
    const spellsDiv = document.getElementById("spells");
    const statusDiv = document.getElementById("status");

    const directions = {
      north: [0, -1], south: [0, 1], west: [-1, 0], east: [1, 0]
    };

    let themes = {
      fantasy: { player: "ðŸ§™", wall: "ðŸŸ«", floor: "â¬›", exit: "ðŸšª", enemy: "ðŸ‘¹", chest: "ðŸŽ", fireball: "ðŸ”¥", arrow: "ðŸ¹" },
      scifi: { player: "ðŸ‘¨â€ðŸš€", wall: "ðŸ§±", floor: "â—¼ï¸", exit: "ðŸ›¸", enemy: "ðŸ¤–", chest: "ðŸ“¦", fireball: "ðŸ’¥", arrow: "ðŸ”«" },
      horror: { player: "ðŸ§Ÿ", wall: "ðŸª¦", floor: "â¬œ", exit: "ðŸ•³ï¸", enemy: "ðŸ•·ï¸", chest: "ðŸª™", fireball: "ðŸ§¨", arrow: "ðŸª“" }
    };

    let currentTheme = "fantasy";
    let floorMap = {};
    let currentRoom = "0,0";

    let player = {
      x: 1, y: 1, hp: 20, maxHp: 20, exp: 0, level: 1, room: "0,0",
      inventory: ["bow", "sword", "armor", "spell: ignis"],
      spells: ["ignis"], weapon: "sword", ranged: "bow", armor: "armor"
    };

    themeSelect.addEventListener("change", () => {
      currentTheme = themeSelect.value;
      updateUI();
      renderRoom();
    });

    function updateUI() {
      const t = themes[currentTheme];
      legendDiv.innerHTML = `${t.player}=Player<br>${t.enemy}=Enemy<br>${t.wall}=Wall<br>${t.floor}=Floor<br>${t.exit}=Exit<br>${t.chest}=Chest`;
      equipmentDiv.textContent = `Melee: ${player.weapon}\nRanged: ${player.ranged}\nArmor: ${player.armor}`;
      spellsDiv.textContent = player.spells.join("\n");
      inventoryDiv.textContent = player.inventory.filter(i => !i.startsWith("spell:")).join("\n");
    }

    function log(message) {
      statusDiv.textContent += message + "\n";
      statusDiv.scrollTop = statusDiv.scrollHeight;
    }

    function rand(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function createRoom(key) {
      const room = { layout: [], enemies: [], chests: [], exits: {} };
      for (let y = 0; y < roomSize.height; y++) {
        room.layout[y] = Array(roomSize.width).fill("floor");
        for (let x = 0; x < roomSize.width; x++) {
          if (x === 0 || y === 0 || x === roomSize.width - 1 || y === roomSize.height - 1)
            room.layout[y][x] = "wall";
        }
      }
      for (let dir in directions) {
        if (Math.random() < 0.5 || key === "0,0") {
          const [dx, dy] = directions[dir];
          const [rx, ry] = key.split(",").map(Number);
          const cx = dx === 0 ? Math.floor(roomSize.width / 2) : dx > 0 ? roomSize.width - 1 : 0;
          const cy = dy === 0 ? Math.floor(roomSize.height / 2) : dy > 0 ? roomSize.height - 1 : 0;
          room.layout[cy][cx] = "exit";
          room.exits[`${cx},${cy}`] = `${rx + dx},${ry + dy}`;
        }
      }
      if (Math.random() < 0.4) {
        const cx = rand(1, roomSize.width - 2), cy = rand(1, roomSize.height - 2);
        room.layout[cy][cx] = "chest";
        room.chests.push({ x: cx, y: cy, contents: randomLoot() });
      }
      for (let i = 0; i < 2; i++) {
        const ex = rand(1, roomSize.width - 2), ey = rand(1, roomSize.height - 2);
        if (room.layout[ey][ex] === "floor") room.enemies.push({ x: ex, y: ey, hp: 10 });
      }
      floorMap[key] = room;
    }

    function renderRoom(extra = []) {
      const t = themes[currentTheme], room = floorMap[player.room];
      let output = "";
      for (let y = 0; y < roomSize.height; y++) {
        for (let x = 0; x < roomSize.width; x++) {
          let symbol = t[room.layout[y][x]] || "?";
          if (player.x === x && player.y === y) symbol = t.player;
          else if (room.enemies.find(e => e.x === x && e.y === y)) symbol = t.enemy;
          const override = extra.find(p => p[0] === x && p[1] === y);
          output += override ? override[2] : symbol;
        }
        output += "\n";
      }
      output += `HP: ${player.hp}/${player.maxHp}  LVL: ${player.level}  EXP: ${player.exp}`;
      gameDisplay.textContent = output;
      updateUI();
    }

    function move(dx, dy) {
      const room = floorMap[player.room];
      const nx = player.x + dx, ny = player.y + dy;
      const tile = room.layout[ny]?.[nx];
      if (!tile) return;
      const enemy = room.enemies.find(e => e.x === nx && e.y === ny);
      if (enemy) {
        enemy.hp -= 5;
        player.hp -= 1;
        log(`You slash the enemy with your ${player.weapon}!`);
        if (enemy.hp <= 0) {
          room.enemies = room.enemies.filter(e => e !== enemy);
          log("Enemy defeated!");
        }
      } else if (tile === "exit") {
        const next = room.exits[`${nx},${ny}`];
        if (!floorMap[next]) createRoom(next);
        player.room = next;
        player.x = 1; player.y = 1;
        log("You move to a new room.");
      } else if (tile === "chest") {
        const chest = room.chests.find(c => c.x === nx && c.y === ny);
        player.inventory.push(chest.contents);
        if (chest.contents.startsWith("spell: ")) {
          const spell = chest.contents.split(": ")[1];
          if (!player.spells.includes(spell)) player.spells.push(spell);
        }
        room.layout[ny][nx] = "floor";
        room.chests = room.chests.filter(c => c !== chest);
        log("You open the chest and find: " + chest.contents);
        player.x = nx; player.y = ny;
      } else if (tile !== "wall") {
        player.x = nx; player.y = ny;
      }
      renderRoom();
    }

    async function fireProjectile(dx, dy, damage, type) {
      const t = themes[currentTheme];
      const emoji = type === "fireball" ? t.fireball : t.arrow;
      const room = floorMap[player.room];
      let x = player.x + dx, y = player.y + dy;
      while (room.layout[y]?.[x] !== "wall") {
        await new Promise(r => setTimeout(r, 100));
        renderRoom([[x, y, emoji]]);
        const enemy = room.enemies.find(e => e.x === x && e.y === y);
        if (enemy) {
          enemy.hp -= damage;
          log(`Your ${type} hits an enemy for ${damage} damage!`);
          if (enemy.hp <= 0) {
            room.enemies = room.enemies.filter(e => e !== enemy);
            log("Enemy defeated!");
          }
          break;
        }
        x += dx; y += dy;
      }
      renderRoom();
    }

    function handleCommand(cmd) {
      const args = cmd.trim().toLowerCase().split(" ");
      if (args[0] === "cast" && args.length === 3) {
        const [_, spell, dir] = args;
        if (!player.spells.includes(spell)) return log("You don't know that spell.");
        if (!directions[dir]) return log("Invalid direction.");
        fireProjectile(...directions[dir], 10, "fireball");
      } else if (args[0] === "fire" && args.length === 2) {
        const dir = args[1];
        if (!directions[dir]) return log("Invalid direction.");
        fireProjectile(...directions[dir], 5, "arrow");
      } else if (args[0] === "equip" && args.length === 2) {
        const item = args[1];
        if (player.inventory.includes(item)) {
          if (["sword", "axe"].includes(item)) player.weapon = item;
          else if (["bow", "crossbow"].includes(item)) player.ranged = item;
          else if (["armor", "cloak"].includes(item)) player.armor = item;
          log("You equipped " + item);
          updateUI();
        } else log("You don't have that.");
      } else if (args[0] === "examine") {
        log("You examine the area... (not implemented)");
      } else {
        log("Unknown command.");
      }
    }

    function randomLoot() {
      const pool = ["potion", "gold", "armor", "cloak", "sword", "bow", "spell: ignis"];
      return pool[rand(0, pool.length - 1)];
    }

    document.addEventListener("keydown", e => {
      if (document.activeElement === commandInput) return;
      if (e.key === "ArrowUp") move(0, -1);
      if (e.key === "ArrowDown") move(0, 1);
      if (e.key === "ArrowLeft") move(-1, 0);
      if (e.key === "ArrowRight") move(1, 0);
    });

    commandInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        handleCommand(commandInput.value);
        commandInput.value = "";
      }
    });

    createRoom(currentRoom);
    renderRoom();
    log("You awaken in a dungeon...");
  </script>
</body>
</html>
